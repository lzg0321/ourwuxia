var link,jsGame;(function(){var e=window.eval;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout}(),window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout}(),String||(String={}),String.format||(String.format=function(){if(arguments.length==0)return null;var e=arguments[0]||"",t;for(var n=1,r=arguments.length;n<r;n++)t=new RegExp("\\{"+(n-1)+"\\}","gm"),e=e.replace(t,arguments[n]);return t=null,e}),String.getByteLength||(String.getByteLength=function(e){var t,n=0,r=e||"",i=r.length;for(t=0;t<i;t++)r.charCodeAt(t)>=0&r.charCodeAt(t)<=255?n+=1:n+=2;return t=r=i=null,n});if(!Array||!Array.prototype)Array.prototype={};Array.prototype.indexOfAttr=function(e,t){var n=(typeof e).toLowerCase(),r=-1;for(var i=0,s=this.length;i<s;i++)if(n=="string"&&this[i][e]==t||n=="number"&&this[i]==e){r=i;break}return n=null,r};var t={canvas:{id:"linkScreen",defaultId:"linkScreen",defaultFont:"12px Arial",defaultWidth:240,defaultHeight:320,defaultColor:"rgb(0, 0, 0)",bgColor:"#000",cavansDoms:[],ctxs:[],device:"",fps:1,touch:!1,zoom:1},system:{loadRes:null,pageLoad:null,menu:null,run:null,runFn:function(){},rafRun:null,stop:null,over:null,zone:null,active:null,lastDate:Date.now(),timeout:30,isPause:!1,gameFlow:-1,loadedImageToGameFlow:-1,zoneArgs:null,activeArgs:null,spendTime:0,loadResTimer:null,playTimer:null},event:{key:0,keys:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},lastKey:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},pressedKey:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},keyPressCtrl:{up:!0,down:!0,left:!0,right:!0,a:!0,b:!0,c:!0,menu:!0,quit:!0},keyDownGo:!1,keyUpGo:!1,keyPressedGo:!1,keyDownCallBack:null,keyUpCallBack:null,orientationChange:null,touchStart:null,touchEnd:null,touchMove:null,touchCancel:null,clickCallBack:null,mouseDownCallBack:null,mouseUpCallBack:null,mouseMoveCallBack:null,focused:!1,pageFocusCallBack:null,pageUnFocusCallBack:null,pageOffX:0,pageOffY:0},image:{imgs:{},imgObjs:[],initImgs:{},asyncImgObjs:{},imgCount:0,countLoaded:0,version:"",inited:!1},audio:{audios:{}},resource:{queue:[]},ajax:{xhrObj:null,pool:[],poolLength:5,date:null,isTimeout:!1,param:{type:"get",data:null,dataType:"json",url:"",xhr:null,timeout:5e3,before:function(e){},success:function(e,t){},error:function(e,t){},complete:function(e){}}},request:{gets:[]},timer:{lockIds:{}}},n={canvas:{context:{base:0},graphics:{HCENTER:1,VCENTER:2,LEFT:4,RIGHT:8,TOP:16,BOTTOM:32,ANCHOR_LT:20,ANCHOR_LV:6,ANCHOR_LB:36,ANCHOR_HT:17,ANCHOR_HV:3,ANCHOR_HB:33,ANCHOR_RT:24,ANCHOR_RV:10,ANCHOR_RB:40},trans:{TRANS_MIRROR:2,TRANS_NONE:0,TRANS_ROT90:5,TRANS_ROT180:3,TRANS_ROT270:6,TRANS_MIRROR_ROT90:7,TRANS_MIRROR_ROT180:1,TRANS_MIRROR_ROT270:4}},event:{key:{up:38,down:40,left:37,right:39,a:90,b:88,c:67,menu:49,quit:50}},system:{gameFlowType:{menu:0,run:1,stop:2,over:3,zone:4,active:5,loadImage:6,loadedImage:7}}},r={getCanvasDom:function(){var e;return function(){return e||(e=v.getDom(t.canvas.defaultId)),e}}(),getOffsetX:function(e){return e.offsetX||(e.targetTouches&&e.targetTouches[0]?e.targetTouches[0].clientX-r.getCanvasDom().offsetLeft:e.clientX-r.getCanvasDom().offsetLeft)||0},getOffsetY:function(e){return e.offsetY||(e.targetTouches&&e.targetTouches[0]?e.targetTouches[0].clientY-r.getCanvasDom().offsetTop:e.clientY-r.getCanvasDom().offsetTop)||0},keydown:function(e){var n=r.checkKey(e.keyCode);t.event.keyDownGo&&t.event.keys[n]!=undefined&&(t.event.keys[n]=!0),t.event.keyUpGo&&t.event.lastKey[n]!=undefined&&(t.event.lastKey[n]=!1),t.event.keyPressCtrl[n]&&t.event.keyPressedGo&&(t.event.pressedKey[n]!=undefined&&(t.event.pressedKey[n]=!0),t.event.keyPressCtrl[n]=!1),t.event.keyDownCallBack!=null&&t.event.keyDownCallBack(e),n=null},keyup:function(e){var n=r.checkKey(e.keyCode);t.event.keyDownGo&&t.event.keys[n]!=undefined&&(t.event.keys[n]=!1),t.event.keyUpGo&&t.event.lastKey[n]!=undefined&&(t.event.lastKey[n]=!0),t.event.keyPressedGo&&(t.event.pressedKey[n]!=undefined&&(t.event.pressedKey[n]=!1),t.event.keyPressCtrl[n]=!0),t.event.keyUpCallBack!=null&&t.event.keyUpCallBack(e),n=null},orientationchange:function(e){t.event.orientationChange!=null&&t.event.orientationChange(e)},touchstart:function(e){t.event.pageOffX=r.getOffsetX(e),t.event.pageOffY=r.getOffsetY(e),t.event.touchStart!=null&&t.event.touchStart(e,t.event.pageOffX,t.event.pageOffY)},touchend:function(e){e.preventDefault(),t.event.touchEnd!=null&&t.event.touchEnd(e,t.event.pageOffX,t.event.pageOffY)},touchmove:function(e){e.touches.length==1&&e.preventDefault(),t.event.pageOffX=r.getOffsetX(e),t.event.pageOffY=r.getOffsetY(e),t.event.touchMove!=null&&t.event.touchMove(e,t.event.pageOffX,t.event.pageOffY)},touchcancel:function(e){t.event.pageOffX=r.getOffsetX(e),t.event.pageOffY=r.getOffsetY(e),t.event.touchCancel!=null&&t.event.touchCancel(e,t.event.pageOffX,t.event.pageOffY)},click:function(e){t.event.clickCallBack!=null&&t.event.clickCallBack(e,r.getOffsetX(e),r.getOffsetY(e))},mouseDown:function(e){t.event.mouseDownCallBack!=null&&t.event.mouseDownCallBack(e,r.getOffsetX(e),r.getOffsetY(e))},mouseUp:function(e){t.event.mouseUpCallBack!=null&&t.event.mouseUpCallBack(e,r.getOffsetX(e),r.getOffsetY(e))},mouseMove:function(e){t.event.mouseMoveCallBack!=null&&t.event.mouseMoveCallBack(e,r.getOffsetX(e),r.getOffsetY(e))},pageFocus:function(e){if(t.event.focused)return t.event.focused=!1,!1;t.event.pageFocusCallBack!=null&&t.event.pageFocusCallBack(e)},pageUnFocus:function(e){t.event.pageUnFocusCallBack!=null&&t.event.pageUnFocusCallBack(e)},checkKey:function(e){var t="0";for(var r in n.event.key)if(n.event.key[r]==e){t=r;break}return t},getDeviceConfig:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("duopaosafari")!=-1?{device:"duopaoSafari",fps:1,touch:!0,zoom:1}:e.indexOf("iphone")!=-1||e.indexOf("ipod")!=-1?{device:"iphone",fps:1,touch:!0,zoom:1}:e.indexOf("ipad")!=-1?{device:"ipad",fps:1,touch:!0,zoom:1}:e.indexOf("duopaoandroid")!=-1?{device:"duopaoAndroid",fps:1,touch:!0,zoom:1}:e.indexOf("duopaowindowsphone")!=-1?{device:"duopaoWindowsPhone",fps:1,touch:!0,zoom:1}:e.indexOf("opera mobi")!=-1?{device:"operamobile",fps:1,touch:!0,zoom:1}:e.indexOf("flyflow")!=-1?{device:"flyflow",fps:1,touch:!0,zoom:1}:e.indexOf("android")!=-1?{device:"android",fps:1,touch:!0,zoom:1}:e.indexOf("iemobile")!=-1?{device:"iemobile",fps:1,touch:!1,zoom:1}:e.indexOf("j2me")!=-1?{device:"j2me",fps:1,touch:!1,zoom:1}:e.indexOf("symbian v5")!=-1?{device:"symbian5",fps:1,touch:!0,zoom:1}:e.indexOf("symbian v3")!=-1?{device:"symbian3",fps:1,touch:!1,zoom:1}:e.indexOf("chrome")!=-1?{device:"chrome",fps:1,touch:!1,zoom:1}:e.indexOf("firefox")!=-1?{device:"firefox",fps:1,touch:!1,zoom:1}:e.indexOf("msie")!=-1?{device:"ie",fps:.5,touch:!1,zoom:1}:e.indexOf("windows")!=-1?{device:"ie",fps:.5,touch:!1,zoom:1}:e.indexOf("safari")!=-1?{device:"safari",fps:1,touch:!1,zoom:1}:e.indexOf("opera")!=-1?{device:"opera",fps:1,touch:!1,zoom:1}:{device:"",fps:1,touch:!1,zoom:1}},setImage:function(e,n,r,i,s){if(!e||!n)return!1;t.image.imgs[e]||(t.image.imgs[e]=new Image,t.image.imgs[e].onload=function(){t.image.countLoaded++,this.loaded=!0,this.cache&&v.canvas.pass(this.id,this.width,this.height).drawImage(this.id,0,0).pass().base().delImage(this.id,!0)},t.image.imgs[e].src=n+(t.image.version!=""?"?v="+t.image.version:""),t.image.imgs[e].id=e,t.image.imgs[e].url=n,t.image.imgs[e].benchId=r,t.image.imgs[e].bench=i,t.image.imgs[e].cache=s,t.image.imgs[e].refreshed=!1)},setAudio:function(e,n,r,i,s,o){if(!e||!n)return!1;if(!t.audio.audios[e]){var u=new Audio(n+(t.image.version!=""?"?v="+t.image.version:""));u.id=e,u.autoplay=i,u.preload=s,u.autobuffer=o,u.loop=r,t.audio.audios[u.id]=u,u=null}},loadingCallBack:function(e,n,r){var i=v.canvas.screen.getWidth(),s=v.canvas.screen.getHeight(),o=i,u=5,a=parseInt(i-o>>1),f=s-u,e=e>n?n:e,l=parseInt(e/n*100)+"%";v.canvas.fillStyle(t.canvas.bgColor).fillRect(0,0,i,s).fillStyle("#00FFFF").fillRect(a,f,parseInt(e/n*o),u).fillStyle("#FFF").fillText("loading "+r,5,s-10).fillText(l,i-v.canvas.measureText(l).width-5,s-10),i=s=o=u=a=f=l=null},getAnchor:function(e,t,r,i,s){var o=e,u=t;switch(s){case n.canvas.graphics.ANCHOR_HV:o-=parseInt(r/2),u-=parseInt(i/2);break;case n.canvas.graphics.ANCHOR_LV:u-=parseInt(i/2);break;case n.canvas.graphics.ANCHOR_RV:o-=r,u-=parseInt(i/2);break;case n.canvas.graphics.ANCHOR_HT:o-=parseInt(r/2);break;case 0:case n.canvas.graphics.ANCHOR_LT:default:break;case n.canvas.graphics.ANCHOR_RT:o-=r;break;case n.canvas.graphics.ANCHOR_HB:o-=parseInt(r/2),u-=i;break;case n.canvas.graphics.ANCHOR_LB:u-=i;break;case n.canvas.graphics.ANCHOR_RB:o-=r,u-=i}return{x:o,y:u}},initUrlParams:function(e){if(e.indexOf("?")>=0){var n=e.split("?"),r=[];n[1].indexOf("&")>=0?r=n[1].split("&"):r.push(n[1]);var i=[];for(var s=0;s<r.length;s++)r[s].indexOf("=")>=0&&(i=r[s].split("="),t.request.gets[i[0]]=i[1]);i=null,r=null,n=null}},audioEnded:function(){v.audio.replay(this.id)},pageLoaded:function(){t.image.inited=!0,t.system.pageLoad(v)}},i,s,o,u,a,f,l,c,h,p,d={arr:[],len:0,v:0};link={init:function(e,n){return!e&&!n?(this.version=1,this.request.init(),this.canvas.initDevice(),this.localStorage.init(),this.sessionStorage.init()):(t.canvas.defaultWidth=e,t.canvas.defaultHeight=n),this},extend:function(e,t,n){var r=n||{};if(t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.prototype.superClass=t.prototype,i=null}for(var s in r)e.prototype[s]=r[s];return r=null,e},setAjax:function(e){return t.ajax.param=this.objExtend(t.ajax.param,e||{}),this},ajax:function(e){e&&t.ajax.pool.length<t.ajax.poolLength&&t.ajax.pool.push(e),e&&e.clear&&(t.ajax.pool=[]),t.ajax.xhr||(t.ajax.xhr=new XMLHttpRequest,t.ajax.xhr.onreadystatechange=function(){if(t.ajax.isTimeout)return!1;var e=t.ajax.xhr,n=t.ajax.xhrObj;if(n&&e.readyState==4){t.ajax.date&&(clearTimeout(t.ajax.date),t.ajax.date=null);if(e.status==200){var r;switch(n.dataType){case"HTML":case"SCRIPT":case"XML":r=e.responseText;break;case"TEXT":default:r=e.responseText.replace(/<[^>].*?>/g,"");break;case"JSON":r=v.getJson(e.responseText)}n.success(r,n),n.complete(n)}else n.error(n,"error");t.ajax.xhrObj=null,v.ajax()}e=n=null});if(t.ajax.xhrObj==null&&t.ajax.pool.length>0){t.ajax.xhrObj=this.objExtend(t.ajax.param,t.ajax.pool.shift()||{});var n=t.ajax.xhr,r=t.ajax.xhrObj,i=t.ajax.xhrObj.url,s=null,o=r.data;r.type=r.type.toUpperCase(),r.dataType=r.dataType.toUpperCase(),t.ajax.isTimeout=!1;if(typeof o=="string")s=o;else if(typeof o=="object"){s=[];for(var u in o)s.push(u+"="+o[u]);s=s.join("&")}r.type=="GET"&&(i+="?"+s),n.open(r.type,i,!0),r.before(t.ajax.xhrObj),r.type=="POST"&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),n.send(s),n=r=s=o=i=null,t.ajax.date=setTimeout(function(){v.ajax({clear:!0}),t.ajax.isTimeout=!0,t.ajax.xhrObj&&(t.ajax.xhrObj.error(t.ajax.xhrObj,"timeout"),t.ajax.xhrObj=null)},t.ajax.xhrObj.timeout)}return this},getDom:function(e){try{return document.getElementById(e)}catch(t){return document.all[e]}},objExtend:function(){var e=this.clone(arguments[0])||{},t=1,n=arguments.length,r=!1,i;typeof e=="boolean"&&(r=e,e=arguments[1]||{},t=2),typeof e!="object"&&(e={}),n==t&&(e=this,--t);if(!arguments[1])return e;for(;t<n;t++)if((i=arguments[t])!=null)for(var s in i){var o=e[s],u=i[s];if(e===u)continue;r&&u&&typeof u=="object"&&!u.nodeType?e[s]=this.objExtend(r,o||(u.length!=null?[]:{}),u):u!==undefined&&(e[s]=u)}return e},getJson:function(t){var n={};try{window.JSON?n=JSON.parse(t):n=e("("+t+")")}catch(r){}return n},clone:function(){var e=arguments[0],t=e||[];if(typeof t=="object")if(t.length!=undefined){e=[];for(var n=0,r=t.length;n<r;n++){if(t[n]===undefined)continue;t[n]!=null&&typeof t[n]=="object"?t[n].length!=undefined?e[n]=t[n].slice(0):e[n]=t[n]:e[n]=t[n]}}else{e={};for(var n in t){if(t[n]===undefined)continue;t[n]!=null&&typeof t[n]=="object"?t[n].length!=undefined?e[n]=t[n].slice(0):e[n]=t[n]:e[n]=t[n]}}return t=null,e},classes:{},comm:{registerNotify:function(e,t){e!=null&&e.register(t)},rangeRegisterNotify:function(e,t){for(var n=0;n<t.length;n++)v.commandFuns.registerNotify(e,t[n])},unRegisterNotify:function(e,t){e!=null&&e.unregister(t)},rangeUnRegisterNotify:function(e,t){for(var n=0;n<t.length;n++)v.commandFuns.unRegisterNotify(e,t[n])},getRandom:function(e,t){if(!t){var n=e;if(!n||n<0)n=0;return Math.round(Math.random()*n)}return Math.round(Math.random()*(t-e)+e)},getArray:function(e,t){d.arr=[],d.len=e.toString().length,d.v=e;for(var n=0;n<d.len;n++)d.arr.push(d.v%10),d.v=parseInt(d.v/10);return t||d.arr.reverse(),d.arr},inArray:function(e,t){var n,r=t.length;for(n=0;n<r;n++)if(e==t[n])return n;return-1},collision:function(e,t,n,r,i,s,o,u){return o&&Math.abs(e+parseInt(n/2)-(i+parseInt(o/2)))<parseInt((n+o)/2)&&Math.abs(t+parseInt(r/2)-(s+parseInt(u/2)))<parseInt((r+u)/2)?!0:!1},circleCollision:function(e,t,n,r,i,s){var o=Math.abs(e-r),u=Math.abs(t-i);return Math.sqrt(o*o+u*u)<n+s?!0:!1},createPath:function(e,t,n,r,i){var s=[],o=e||0,u=t||0,a=n||0,f=r||0,l=a-o,c=f-u,h=Math.sqrt(Math.pow(l,2)+Math.pow(c,2)),p=i||5,d=p,v=0,m=0,g,y,b=Math.atan2(c,l)/Math.PI*180;b=b>=0?b:b+360;while(d<h+p)d=d>h?h:d,g=d*Math.cos(b/180*Math.PI),y=d*Math.sin(b/180*Math.PI),s.unshift([g-v,y-m]),v=g,m=y,d+=p;return o=u=a=f=l=c=h=p=d=b=null,s}},localStorage:function(){var e,t,n=function(){var e;try{e=window.localStorage,e.getItem||(e.getItem=function(){return null}),e.setItem||(e.setItem=function(){})}catch(t){e={getItem:function(){return null},setItem:function(){}}}return e};return{init:function(){return e=this,t||(t=n()),e},setItem:function(n,r){try{t.setItem(n,r)}catch(i){}return e},getItem:function(e){return t.getItem(e)},removeItem:function(n){return t.removeItem(n),e},clear:function(){return t.clear(),e},key:function(e){return t.key(e)},getLength:function(){return t.length},base:function(){return v}}}(),sessionStorage:function(){var e,t,n=function(){var e;try{e=window.sessionStorage,e.getItem||(e.getItem=function(){return null}),e.setItem||(e.setItem=function(){})}catch(t){e={getItem:function(){return null},setItem:function(){}}}return e};return{init:function(){return e=this,t||(t=n()),e},setItem:function(n,r){return t.setItem(n,r),e},getItem:function(e){return t.getItem(e)},removeItem:function(n){return t.removeItem(n),e},clear:function(){return t.clear(),e},key:function(e){return t.key(e)},getLength:function(){return t.length},base:function(){return v}}}(),pageLoad:function(e){return t.system.pageLoad==null&&(t.system.pageLoad=e,window.addEventListener("load",function(){v.canvas.init(),v.graphics.ANCHOR_LT=n.canvas.graphics.ANCHOR_LT,v.graphics.ANCHOR_LV=n.canvas.graphics.ANCHOR_LV,v.graphics.ANCHOR_LB=n.canvas.graphics.ANCHOR_LB,v.graphics.ANCHOR_HT=n.canvas.graphics.ANCHOR_HT,v.graphics.ANCHOR_HV=n.canvas.graphics.ANCHOR_HV,v.graphics.ANCHOR_HB=n.canvas.graphics.ANCHOR_HB,v.graphics.ANCHOR_RT=n.canvas.graphics.ANCHOR_RT,v.graphics.ANCHOR_RV=n.canvas.graphics.ANCHOR_RV,v.graphics.ANCHOR_RB=n.canvas.graphics.ANCHOR_RB;var e=v.getDom(t.canvas.defaultId);e&&(v.canvas.screen.getTouch()?(window.addEventListener("orientationchange",r.orientationchange,!1),e.addEventListener("touchstart",r.touchstart,!1),e.addEventListener("touchend",r.touchend,!1),e.addEventListener("touchmove",r.touchmove,!1),e.addEventListener("touchcancel",r.touchcancel,!1)):(document.onkeydown=r.keydown,document.onkeyup=r.keyup,e.addEventListener("click",r.click,!1),e.addEventListener("mousedown",r.mouseDown,!1),e.addEventListener("mouseup",r.mouseUp,!1),e.addEventListener("mousemove",r.mouseMove,!1))),e=null;var i=v.canvas.screen.getDevice();i=="ipad"||i=="iphone"?(t.event.focused=!0,window.addEventListener("pageshow",r.pageFocus,!1),window.addEventListener("pagehide",r.pageUnFocus,!1)):(i=="firefox"&&(t.event.focused=!0),window.addEventListener("focus",r.pageFocus,!1),window.addEventListener("blur",r.pageUnFocus,!1)),v.canvas.fillStyle(t.canvas.bgColor).fillRect(0,0,v.canvas.screen.getWidth(),v.canvas.screen.getHeight()),t.image.inited=!1,v.gameFlow.run().base().play(),t.image.imgObjs.length>0?v.loadImage(t.image.imgObjs):r.pageLoaded()},!1)),v},menu:function(e){return typeof e=="function"&&(t.system.menu=e),this},run:function(e){return typeof e=="function"&&(t.system.runFn=e),this},stop:function(e){return typeof e=="function"&&(t.system.stop=e),this},over:function(e){return typeof e=="function"&&(t.system.over=e),this},zone:function(e){return typeof e=="function"&&(t.system.zone=e),this},active:function(e){return typeof e=="function"&&(t.system.active=e),this},play:function(){return t.system.run||(t.system.run=function(){var e=Date.now();switch(t.system.gameFlow){case n.system.gameFlowType.menu:t.system.menu();break;case n.system.gameFlowType.run:t.system.runFn();break;case n.system.gameFlowType.stop:t.system.stop();break;case n.system.gameFlowType.over:t.system.over();break;case n.system.gameFlowType.zone:t.system.zone(t.system.zoneArgs);break;case n.system.gameFlowType.active:t.system.active(t.system.activeArgs);break;case n.system.gameFlowType.loadImage:if(r.loadingCallBack!=null){var i=t.image.imgCount,s=t.image.countLoaded>i?i:t.image.countLoaded;s==i&&(t.system.gameFlow=n.system.gameFlowType.loadedImage),i>0&&r.loadingCallBack(s,i,"image"),s=i=null}break;case n.system.gameFlowType.loadedImage:t.system.gameFlow=t.system.loadedImageToGameFlow,t.image.imgObjs=[],t.image.countLoaded=0,t.image.inited||r.pageLoaded();break;default:}t.system.spendTime=Date.now()-e,e=null}),t.system.playTimer||(t.system.isPause=!1,(t.system.rafRun=function(){var e=Date.now();e-t.system.lastDate>=t.system.timeout-t.system.spendTime&&(t.system.lastDate=e,t.system.isPause||t.system.run()),e=null,t.system.rafRun&&(t.system.playTimer=requestAnimationFrame(t.system.rafRun))})()),this},pause:function(){return t.system.playTimer&&(t.system.isPause=!0,t.system.rafRun=null,cancelAnimationFrame(t.system.playTimer),t.system.playTimer=null),this},gameFlow:{menu:function(){return t.system.menu!=null&&(t.system.gameFlow=n.system.gameFlowType.menu,v.resetKeys()),this},run:function(){return t.system.runFn!=null&&(t.system.gameFlow=n.system.gameFlowType.run,v.resetKeys()),this},stop:function(){return t.system.stop!=null&&(t.system.gameFlow=n.system.gameFlowType.stop,v.resetKeys()),this},over:function(){return t.system.over!=null&&(t.system.gameFlow=n.system.gameFlowType.over,v.resetKeys()),this},zone:function(e){return t.system.zone!=null&&(t.system.gameFlow=n.system.gameFlowType.zone,t.system.zoneArgs=e,v.resetKeys()),this},active:function(e){return t.system.active!=null&&(t.system.gameFlow=n.system.gameFlowType.active,t.system.activeArgs=e,v.resetKeys()),this},isIn:function(e){return t.system.gameFlow==n.system.gameFlowType[e]},base:function(){return v}},keyRepeated:function(e){return t.event.keyDownGo||(t.event.keyDownGo=!0),t.event.keys[e]},keyPressed:function(e){t.event.keyPressedGo||(t.event.keyPressedGo=!0);var n=t.event.pressedKey[e];return t.event.pressedKey[e]=!1,n},keyReleased:function(e){t.event.keyUpGo||(t.event.keyUpGo=!0);var n=t.event.lastKey[e];return t.event.lastKey[e]=!1,n},setKeyCode:function(e,r){return t.event.keys[e]=!1,t.event.lastKey[e]=!1,t.event.pressedKey[e]=!1,t.event.keyPressCtrl[e]=!0,n.event.key[e]=r,this},resetKeys:function(){for(var e in t.event.keys)t.event.keys[e]=!1;for(var e in t.event.lastKey)t.event.lastKey[e]=!1;for(var e in t.event.pressedKey)t.event.pressedKey[e]=!1;for(var e in t.event.keyPressCtrl)t.event.keyPressCtrl[e]=!0;return this},canvas:{init:function(){return s={x:0,y:0},o={fillColor:"#000000",strokeColor:"#000000"},u={x:0,y:0},a={x:0,y:0},f={x:0,y:0,fillStyle:"#FFFFFF",strokeStyle:"#CCCCCC"},this.pass()},initDevice:function(){return c=r.getDeviceConfig(),t.canvas.device=c.device,t.canvas.fps=c.fps,t.canvas.touch=c.touch,t.canvas.zoom=c.zoom,this},pass:function(e,n,r){var s,o;return!e||e==""?s=t.canvas.defaultId:s=e,t.canvas.ctxs[s]||(o=this.base().getDom(s)||document.createElement("canvas"),t.canvas.ctxs[s]=null,delete t.canvas.ctxs[s],t.canvas.ctxs[s]=o.getContext("2d"),o.width=n?n:t.canvas.defaultWidth,o.style.width=parseInt(o.width*t.canvas.zoom)+"px",o.height=r?r:t.canvas.defaultHeight,o.style.height=parseInt(o.height*t.canvas.zoom)+"px",t.canvas.cavansDoms[s]=null,delete t.canvas.cavansDoms[s],t.canvas.cavansDoms[s]=o),i=t.canvas.ctxs[s],i.font=t.canvas.defaultFont,l=t.canvas.cavansDoms[s],h=parseInt(l.width),p=parseInt(l.height),this.screen.setId(s),this},font:function(e){return t.canvas.defaultFont=e,i.font=t.canvas.defaultFont,this},del:function(e){return t.canvas.ctxs[e]&&(t.canvas.ctxs[e]=null,delete t.canvas.ctxs[e],t.canvas.cavansDoms[e]=null,delete t.canvas.cavansDoms[e]),this},setCurrent:function(e){return _canvas.pass(e)},screen:{setId:function(e){return t.canvas.ctxs[e]&&(t.canvas.id=e),this},getId:function(){return t.canvas.id},getWidth:function(){return h},setWidth:function(e){return t.canvas.defaultWidth=e,l&&(l.width=t.canvas.defaultWidth,l.style.width=l.width+"px",h=parseInt(l.width)),this},getHeight:function(){return p},setHeight:function(e){return t.canvas.defaultHeight=e,l&&(l.height=t.canvas.defaultHeight,l.style.height=l.height+"px",p=parseInt(l.height)),this},getDevice:function(){return t.canvas.device},getFps:function(){return t.canvas.fps},setFps:function(e){return e>0&&(t.canvas.fps=e),this},getTouch:function(){return t.canvas.touch},getZoom:function(){return t.canvas.zoom}},fillStyle:function(e){return i.fillStyle=e,this},fillRect:function(e,t,n,s,o){return n=n?n:0,s=s?s:0,o?a=r.getAnchor(e,t,n,s,o):(a.x=e,a.y=t),i.fillRect(a.x,a.y,n,s),this},fillText:function(e,n,r,s){return i.font=s||t.canvas.defaultFont,i.fillText(e,n,r),this},clearRect:function(e,t,n,r){return i.clearRect(e,t,n,r),this},clearScreen:function(){return this.clearRect(0,0,h,p)},fillScreen:function(){return this.fillRect(0,0,h,p)},strokeStyle:function(e){return i.strokeStyle=e,this},lineWidth:function(e){return i.lineWidth=e||1,this},strokeRect:function(e,t,n,s,o){return o?u=r.getAnchor(e,t,n,s,o):(u.x=e,u.y=t),i.strokeRect(u.x,u.y,n,s),this},strokeText:function(e,n,r,s){return i.font=s||t.canvas.defaultFont,i.strokeText(e,n,r),this},setColor:function(e,t,n){return n==null?(o.fillColor=e,o.strokeColor=t?t:e):(o.fillColor="rgb("+e+", "+t+", "+n+")",o.strokeColor=o.fillColor),this.fillStyle(o.fillColor).strokeStyle(o.strokeColor)},drawImage:function(e,n,o,u,a,f,l,c,h,p){var d=v.getImage(e);if(d.refreshed)this.drawCache(e,n,o,u,a,f,l,c,h,p);else if(d.src!=null)c!=null&&(n=n<0?0:n,c=c<=0?.1:c),h!=null&&(o=o<0?0:o,h=h<=0?.1:h),u!=null&&c!=null&&(u=u<=0?.1:n+u<=d.width?u:d.width-n),a!=null&&h!=null&&(a=a<=0?.1:o+a<=d.height?a:d.height-o),d.loaded&&(u?a?p?(s=r.getAnchor(f,l,c,h,p),i.drawImage(d,n,o,u,a,s.x,s.y,c,h)):i.drawImage(d,n,o,u,a,f,l,c,h):(s=r.getAnchor(n,o,d.width,d.height,u),i.drawImage(d,s.x,s.y)):i.drawImage(d,n,o));else{var m=t.image.asyncImgObjs[e];m&&!m.inited&&(r.setImage(m.id,m.src,m.benchId,m.bench,m.cache),m.inited=!0),m=null}return d=null,this},drawRotate:function(e,n,r,s,o,u,a,f,l,c){var h=parseInt(f>>1),p=parseInt(l>>1),d=v.getImage(e),m=d?d:t.canvas.cavansDoms[e];return u-=h,a-=p,i.save(),i.translate(u+h,a+p),i.rotate(c*Math.PI/180),i.translate(-(u+h),-(a+p)),i.drawImage(m,n,r,s,o,u,a,f,l),i.restore(),m=null,d=null,p=null,h=null,this},drawCache:function(e,n,o,u,a,f,l,c,h,p){var d=t.canvas.cavansDoms[e];return d&&(c!=null&&(n=n<0?0:n,c=c<=0?.1:c),h!=null&&(o=o<0?0:o,h=h<=0?.1:h),u!=null&&c!=null&&(u=u<=0?.1:n+u<=d.width?u:d.width-n),a!=null&&h!=null&&(a=a<=0?.1:o+a<=d.height?a:d.height-o),u?a?p?(s=r.getAnchor(f,l,c,h,p),i.drawImage(d,n,o,u,a,s.x,s.y,c,h)):i.drawImage(d,n,o,u,a,f,l,c,h):(s=r.getAnchor(n,o,d.width,d.height,u),i.drawImage(d,s.x,s.y)):i.drawImage(d,n,o)),d=null,this},drawRegion:function(e,t,r,s,o,u,a,f,l){switch(u){case n.canvas.trans.TRANS_NONE:default:i.transform(1,0,0,1,a,f);break;case n.canvas.trans.TRANS_ROT90:i.transform(0,1,-1,0,o+a,f);break;case n.canvas.trans.TRANS_ROT180:i.transform(-1,0,0,-1,s+a,o+f);break;case n.canvas.trans.TRANS_ROT270:i.transform(0,-1,1,0,a,s+f);break;case n.canvas.trans.TRANS_MIRROR:i.transform(-1,0,0,1,s+a,f);break;case n.canvas.trans.TRANS_MIRROR_ROT90:i.transform(0,-1,-1,0,o+a,s+f);break;case n.canvas.trans.TRANS_MIRROR_ROT180:i.transform(1,0,0,-1,a,o+f);break;case n.canvas.trans.TRANS_MIRROR_ROT270:i.transform(0,1,1,0,a,f)}var c=v.getImage(e),h=c.cache?this.drawCache:this.drawImage;return h(e,t,r,s,o,0,0,s,o),i.setTransform(1,0,0,1,0,0),h=null,c=null,this},drawRegionAndZoom:function(e,t,r,s,o,u,a,f,l,c,h){switch(u){case n.canvas.trans.TRANS_NONE:default:i.transform(1,0,0,1,a,f);break;case n.canvas.trans.TRANS_ROT90:i.transform(0,1,-1,0,h+a,f);break;case n.canvas.trans.TRANS_ROT180:i.transform(-1,0,0,-1,c+a,h+f);break;case n.canvas.trans.TRANS_ROT270:i.transform(0,-1,1,0,a,c+f);break;case n.canvas.trans.TRANS_MIRROR:i.transform(-1,0,0,1,c+a,f);break;case n.canvas.trans.TRANS_MIRROR_ROT90:i.transform(0,-1,-1,0,h+a,c+f);break;case n.canvas.trans.TRANS_MIRROR_ROT180:i.transform(1,0,0,-1,a,h+f);break;case n.canvas.trans.TRANS_MIRROR_ROT270:i.transform(0,1,1,0,a,f)}var p=v.getImage(e),d=p.cache?this.drawCache:this.drawImage;return d(e,t,r,s,o,0,0,c,h),i.setTransform(1,0,0,1,0,0),d=null,p=null,this},drawNumber:function(e,t,n,r,i,s,o,u,a){var f=e.toString(),l=f.length,c=u?u:n,p=a?a:r;if(o=="center"){var d=i+parseInt(h-c*l>>1);for(var m=0;m<l;m++)this.drawImage(t,parseInt(f.charAt(m))*n,0,n,r,d+m*c,s,c,p);d=null}else if(o==1)for(var m=0;m<l;m++)this.drawImage(t,parseInt(f.charAt(m))*n,0,n,r,i+m*c,s,c,p);else if(o==0)for(var m=l-1;m>=0;m--)this.drawImage(t,parseInt(f.charAt(m))*n,0,n,r,i-(l-1-m)*c,s,c,p,v.graphics.ANCHOR_RT);return p=null,c=null,l=null,f=null,this},moveTo:function(e,t){return i.moveTo(e,t),this},lineTo:function(e,t){return i.lineTo(e,t),this},stroke:function(){return i.stroke(),this},fill:function(){return i.fill(),this},beginPath:function(){return i.beginPath(),this},closePath:function(){return i.closePath(),this},arc:function(e,t,n,r,s,o){return i.arc(e,t,n,r,s,o),this},quadraticCurveTo:function(e,t,n,r){return i.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,s,o){return i.bezierCurveTo(e,t,n,r,s,o),this},measureText:function(e){var t=i.measureText(e),n=t.width,r=t.height?t.height:parseInt(i.font);return{width:this.screen.getDevice()=="j2me"?i.measureText(e):n,height:r}},translate:function(e,t){return i.translate(e,t),this},drawLine:function(e,t,n,r){return this.beginPath().moveTo(e,t).lineTo(n,r).closePath().stroke()},drawRect:function(e,t,n,r,i){return this.strokeRect(e,t,n,r,i)},drawString:function(e,r,s,o,u,a,l,c){f.x=r,f.y=s,i.font=c||t.canvas.defaultFont;if(o)switch(o){case n.canvas.graphics.LEFT:f.x=0;break;case n.canvas.graphics.VCENTER:f.x=parseInt(this.screen.getWidth()-this.measureText(e).width>>1);break;case n.canvas.graphics.RIGHT:f.x=this.screen.getWidth()-this.measureText(e).width;break;default:}return u&&(a?f.fillStyle=a:f.fillStyle="#000000",l?f.strokeStyle=l:f.strokeStyle="#CCCCCC",this.fillStyle(f.strokeStyle).fillText(e,f.x+1,f.y+1,c).fillStyle(f.fillStyle)),this.fillText(e,f.x,f.y,c).fillStyle(t.canvas.defaultColor)},drawSubstring:function(e,t,n,r,i,s,o,u,a,f){return this.drawString(e.substring(t,t+n),r,i,s,o,u,a,f)},clip:function(){return i.clip(),this},save:function(){return i.save(),this},restore:function(){return i.restore(),this},rect:function(e,t,n,r){return i.rect(e,t,n,r),this},rotate:function(e){return i.rotate(e),this},setTransform:function(e,t,n,r,s,o){return i.setTransform(e,t,n,r,s,o),this},scale:function(e,t){return i.scale(e,t),this},globalAlpha:function(e){return i.globalAlpha=e,this},getContext:function(){return i},base:function(){return v}},pushImage:function(e){if(t.image.inited)return this;var n;for(var r=0,i=e.length;r<i;r++)n=e[r],n&&!t.image.initImgs[n.id]&&(t.image.initImgs[n.id]=!0,t.image.imgObjs.push(e[r]));return n=null,this},loadImage:function(e){if(t.system.gameFlow!=n.system.gameFlowType.loadImage&&e.length>0){t.system.loadedImageToGameFlow=t.system.gameFlow,t.system.gameFlow=n.system.gameFlowType.loadImage,t.image.imgObjs=e,t.image.imgCount=t.image.imgObjs.length,t.image.countLoaded=0;for(var i=0,s;s=t.image.imgObjs[i];i++)t.image.imgs[s.id]?t.image.countLoaded++:r.setImage(s.id,s.src,s.benchId)}return this},asyncImage:function(e){var n;for(var r=0,i=e.length;r<i;r++)n=e[r]||{},t.image.asyncImgObjs[n.id]||(t.image.asyncImgObjs[n.id]=n);return n=null,this},verImage:function(e){return t.image.version==""&&(t.image.version=e),this},loadingCallBack:function(e){return typeof e=="function"&&(r.loadingCallBack=e),this},addImage:function(e,n){return e&&n&&!t.image.imgs[e]&&(t.image.imgs[e]=n),this},getImage:function(e){return t.image.imgs[e]?t.image.imgs[e]:{src:null}},delImage:function(e,n){return t.image.imgs[e]&&(t.image.imgs[e]=null,delete t.image.imgs[e],n&&(t.image.imgs[e]={id:e,loaded:!0,cache:!0,refreshed:!0})),this},getAsyncImage:function(e){return t.image.asyncImgObjs[e]?t.image.asyncImgObjs[e]:{src:null}},clearAsyncImageCache:function(){try{var e=t.image.imgs,n,r;for(var i in e)n=e[i],n&&(r=t.image.asyncImgObjs[i],r&&(r.inited=!1,this.delImage(i).canvas.del(i)));e=n=r=null}catch(s){}return this},audio:{play:function(e){var n=t.audio.audios[e];if(n)try{n.currentTime>=n.duration?this.replay(e):n.paused&&n.play()}catch(r){}return n=null,this},playRange:function(e,n,r){var i=t.audio.audios[e];if(i)try{i.__timeupdateCallBack__||i.addEventListener("timeupdate",i.__timeupdateCallBack__=function(){this.currentTime>=this.__to__&&(this.loop?this.currentTime=this.__from__:this.pause())},!1),i.__from__=n==null?0:n,i.__to__=r==null?i.duration:r,this.setCurrentTime(i.id,i.__from__).play(i.id)}catch(s){}return i=null,this},pause:function(e){if(t.audio.audios[e])try{t.audio.audios[e].pause()}catch(n){}return this},pauseAll:function(){for(var e in t.audio.audios)this.pause(e);return this},mute:function(e,n){if(t.audio.audios[e])try{t.audio.audios[e].muted=n}catch(r){}},vol:function(e,n){if(t.audio.audios[e])try{t.audio.audios[e].volume=n}catch(r){}return this},loop:function(e,n){if(t.audio.audios[e])try{t.audio.audios[e].loop=n}catch(r){}return this},replay:function(e){return this.setCurrentTime(e,0).play(e),this},setCurrentTime:function(e,n){var r=t.audio.audios[e];if(r)try{n<0?n=0:n>r.duration&&(n=r.duration),r.currentTime=n||0}catch(i){}return r=null,this},getAudio:function(e){return t.audio.audios[e]},del:function(e){var n=t.audio.audios[e];return n&&n.__timeupdateCallBack__&&(n.pause(),n.removeEventListener("timeupdate",n.__timeupdateCallBack__,!1),t.audio.audios[e]=null,delete t.audio.audios[e]),n=null,this},base:function(){return v}},initAudio:function(e){if(!window.Audio)return this;if(e.length>0){t.audio.audios={};var n,i,s,o,u;for(var a=0;a<e.length;a++)n=e[a],n&&r.setAudio(n.id,n.src,n.loop,n.autoplay,n.preload,n.autobuffer);n=i=s=o=u=null}return this},setRunFrequency:function(e){return t.system.timeout=e,this},events:{keyDown:function(e){return t.event.keyDownGo||(t.event.keyDownGo=!0),t.event.keyUpGo||(t.event.keyUpGo=!0),t.event.keyPressedGo||(t.event.keyPressedGo=!0),t.event.keyDownCallBack=e,this},keyUp:function(e){return t.event.keyDownGo||(t.event.keyDownGo=!0),t.event.keyUpGo||(t.event.keyUpGo=!0),t.event.keyPressedGo||(t.event.keyPressedGo=!0),t.event.keyUpCallBack=e,this},orientationChange:function(e){return t.event.orientationChange=e,this},touchStart:function(e){return t.event.touchStart=e,this},touchEnd:function(e){return t.event.touchEnd=e,this},touchMove:function(e){return t.event.touchMove=e,this},touchCancel:function(e){return t.event.touchCancel=e,this},click:function(e){return t.event.clickCallBack=e,this},mouseDown:function(e){return t.event.mouseDownCallBack=e,this},mouseUp:function(e){return t.event.mouseUpCallBack=e,this},mouseMove:function(e){return t.event.mouseMoveCallBack=e,this},createEvent:function(e,t){var n=document.getElementById(e);if(n){var r=document.createEvent("HTMLEvents");r.initEvent(t,!1,!0),n.dispatchEvent(r),r=null}n=null},pageFocus:function(e){return t.event.pageFocusCallBack=e,this},pageUnFocus:function(e){return t.event.pageUnFocusCallBack=e,this},base:function(){return v}},ui:{},graphics:{HCENTER:n.canvas.graphics.HCENTER,VCENTER:n.canvas.graphics.VCENTER,LEFT:n.canvas.graphics.LEFT,RIGHT:n.canvas.graphics.RIGHT,TOP:n.canvas.graphics.TOP,BOTTOM:n.canvas.graphics.BOTTOM},trans:{TRANS_NONE:n.canvas.trans.TRANS_NONE,TRANS_ROT90:n.canvas.trans.TRANS_ROT90,TRANS_ROT180:n.canvas.trans.TRANS_ROT180,TRANS_ROT270:n.canvas.trans.TRANS_ROT270,TRANS_MIRROR:n.canvas.trans.TRANS_MIRROR,TRANS_MIRROR_ROT90:n.canvas.trans.TRANS_MIRROR_ROT90,TRANS_MIRROR_ROT180:n.canvas.trans.TRANS_MIRROR_ROT180,TRANS_MIRROR_ROT270:n.canvas.trans.TRANS_MIRROR_ROT270},request:{init:function(){r.initUrlParams(window.leiyooHref?window.leiyooHref:location.href)},get:function(e){return t.request.gets[e]?t.request.gets[e]:""}}}.init();var v=jsGame=link,m=document.getElementsByTagName("head")[0],g=null,y=null,b=null,w=null,E=function(){y&&(clearTimeout(y),y=null)};link.getScript=function(e){if(!m||g)return!1;var t=v.objExtend({url:"",before:function(){},success:function(){},error:function(e){},timeout:5e3,contentType:"text/javascript",destroyed:!0},e||{});return t.url!=""&&(t.before(),g=document.createElement("script"),g.type=t.contentType,g.async=!0,g.src=t.url,g.destroyed=t.destroyed,b=t.success,w=t.error,g.onload=function(){E(),b&&(b(),b=null),this.destroyed&&m.removeChild(this),g=null},m.appendChild(g),E(),y=setTimeout(function(){E(),w&&(w("timeout"),w=null),g&&g.destroyed&&m.removeChild(g),g=null},t.timeout)),t=null,v};var S=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};link.getNewGuid=function(){return S()+S()+"-"+S()+"-"+S()+"-"+S()+"-"+S()+S()+S()},link.classes.Observer=function(){this.group=[]},link.classes.Observer.prototype.register=function(e){if(e==null)return this;var t=v.comm.inArray(e,this.group);return t==-1&&this.group.push(e),this},link.classes.Observer.prototype.unregister=function(e){if(e==null)return this;var t=v.commandFuns.inArray(e,this.group);return t>-1&&this.group.splice(t,1),this},link.classes.Observer.prototype.notify=function(e){for(var t=0;t<this.group.length;t++)this.group[t]!=null&&this.group[t](e);return this},link.classes.Observer.prototype.clear=function(){return this.group.length>0&&this.group.splice(0,this.group.length),this},link.classes.Timer=function(e,t,n,r,i){this.id=e,this._initTime=t,this._dateTime=Date.now(),this.time=this._initTime,this.callBack=n,this.millisec=r||1e3,this.data=i,this.timeout=null},link.classes.Timer.prototype.stop=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},link.classes.Timer.prototype.start=function(e){e&&(this.time=this._initTime,this._dateTime=Date.now()),this.stop(),this.timeout=setTimeout(function(e){var t=Date.now(),n=parseInt(Math.round((t-e._dateTime)/e.millisec));e._dateTime=t,e.time-=n,e.callBack?e.callBack(e):e.stop(),e.time>=0?e.start():(e.stop(),e.time=0),t=n=null},this.millisec,this)},link.classes.WebSocket=function(e,t,n,r,i){this.ipPort=e||"",this.socket=new WebSocket(this.ipPort),this.socket.onopen=t,this.socket.onmessage=n,this.socket.onclose=r,this.socket.onerror=i},link.classes.WebSocket.prototype.send=function(e){this.socket.send(e)},link.classes.WebSocket.prototype.close=function(){this.socket.close()},link.classes.observer=link.classes.Observer,link.classes.timer=link.classes.Timer,link.classes.webSocket=link.classes.websocket=link.classes.WebSocket,link.commandFuns=link.comm,link.commandFuns.collisionCheck=link.commandFuns.collision,link.commandFuns.circleCollisionCheck=link.commandFuns.circleCollision,link.initImage=link.pushImage,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("lib/link",[],function(){return link})})(),define("statics",["lib/link"],function(e){return{init:function(){console.error("statics init")}}}),define("index",["lib/link","statics"],function(e,t){return{init:function(){e.pageLoad(function(){console.error(44444)}),t.init()}}}),require.config({baseUrl:"js"}),require(["index"],function(e){e.init()}),define("main",function(){});